
<!--
  ~ Hibernate, Relational Persistence for Idiomatic Java
  ~
  ~ License: GNU Lesser General Public License (LGPL), version 2.1 or later
  ~ See the lgpl.txt file in the root directory or http://www.gnu.org/licenses/lgpl-2.1.html
  -->
<!DOCTYPE hibernate-mapping PUBLIC
        "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
        "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd">

<hibernate-mapping package="org.hibernate.orm.test.sql.hand.hbm" default-access="field">

    <resultset name="explicit-results-mapping">
        <return alias="groupp" class="org.hibernate.orm.test.sql.hand.hbm.Group">
            <return-property name="id" column="group_id" />
            <return-property name="name" column="group_name" />
            <return-property name="admin" column="admin_fk" />
        </return>
        <return-join alias="members" property="groupp.members">
            <return-property name="key" column="group_fk" />
<!--            <return-property name="element" column="employee_fk" />-->
            <return-property name="element.id" column="emp_id" />
            <return-property name="element.name" column="emp_name" />
            <return-property name="element.manager" column="manager_fk" />
        </return-join>
    </resultset>

    <sql-query name="group-members">
        <![CDATA[
        	select 	groupp.id as group_id,
        			groupp.name as group_name,
        			groupp.admin_fk,
        			members.employee_fk,
        			members.group_fk,
        			emp.id as emp_id,
        			emp.name as emp_name,
        			emp.manager_fk
			FROM 	groups groupp,
					members members,
					employees emp
			WHERE 	groupp.id = members.group_fk
					and members.employee_fk = emp.id
       ]]>

        <return alias="groupp" class="org.hibernate.orm.test.sql.hand.hbm.Group">
            <return-property name="id" column="group_id" />
            <return-property name="name" column="group_name" />
            <return-property name="admin" column="admin_fk" />
        </return>
        <return-join alias="members" property="groupp.members">
            <return-property name="key" column="group_fk" />
            <return-property name="element" column="employee_fk" />
            <return-property name="element.id" column="emp_id" />
            <return-property name="element.name" column="emp_name" />
            <return-property name="element.manager" column="manager_fk" />
        </return-join>

    </sql-query>

</hibernate-mapping>